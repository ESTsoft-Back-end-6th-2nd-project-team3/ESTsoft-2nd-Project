<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 페이지</title>
    <link rel="stylesheet" th:href="@{/css/base.css}">
</head>
<body>
<div class="side-login-container">

    <!-- 로그인되지 않은 경우 -->
    <div th:if="${!isLoggedIn}">
        <h2>로그인이 필요합니다!</h2>
        <p>Kakao 아이디로<br>손쉽게 가입 및 이용할 수 있습니다.</p>

        <a href="/oauth2/authorization/kakao" class="kakao-login-btn">
            <img th:src="@{/img/kakao-icon.svg}" alt="카카오로 시작하기 버튼">
        </a>
    </div>

    <!-- 로그인된 경우 -->
    <div th:if="${isLoggedIn}" class="side-login-profile-container">
        <div class="side-login-profile-header">
            <div class="side-login-profile-image-circle" th:style="|background-image: url('${profileImageUrl}');|"></div>

            <div class="side-login-profile-info">
                <p th:text="${userNickname}">닉네임</p>
                <p>
                    <span th:text="${userLevel}">권한</span> |
                    <span th:text="${userActivityScore}">활동점수</span>점
                </p>
            </div>
            <form action="/logout" method="post">
                <button type="submit" class="side-login-logout-btn">로그아웃</button>
            </form>
        </div>

        <!-- 구분선 -->
        <div class="side-login-divider"></div>

        <!-- 하단 메뉴 -->
        <div class="side-login-profile-menu">
            <div class="side-login-menu-item" onclick="toggleMenu('notifications')">알림</div>
            <div class="side-login-menu-item" onclick="toggleMenu('userPosts')">작성글</div>
            <div class="side-login-menu-item" onclick="toggleMenu('announcements')">공지</div>
        </div>
    </div>

    <!-- 데이터 출력 영역 -->
    <div id="menu-data-container" class="side-login-data-container" style="display: none;"></div>

</div>

<script>
    let activeMenu = null;

    function toggleMenu(menuType) {
        const container = document.getElementById('menu-data-container');

        if (activeMenu === menuType) {
            container.style.display = 'none';
            activeMenu = null;
        } else {
            fetchData(menuType);
            container.style.display = 'block';
            activeMenu = menuType;
        }
    }

    function fetchData(menuType) {
        fetch(`/api/${menuType}`)
            .then(response => response.json())
            .then(data => {
                if (menuType === 'userPosts' || menuType === 'notifications' || menuType === 'announcements') {
                    renderDataWithLinks(menuType, data.slice(0, 5));
                } else {
                    displayData(menuType, data);
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                displayData(menuType, []);
            });
    }

    function renderDataWithLinks(menuType, data) {
        const container = document.getElementById('menu-data-container');
        container.innerHTML = '';

        if (data.length === 0) {
            container.innerHTML = '<p>(내용이 없습니다)</p>';
            return;
        }

        let html = `<div class="side-login-post-list">`;

        data.forEach(item => {
            html += `
            <div class="side-login-post-item">
                <span class="side-login-post-category">${item.postType || '카테고리 없음'}</span>
                <a href="${item.postLink}" class="side-login-post-title">${item.title}</a>
                <span class="side-login-post-comments">${item.commentCount || ''}</span>
            </div>
            `;
        });

        html += `</div>`;
        container.innerHTML = html;
    }

    function displayData(menuType, data) {
        const container = document.getElementById('menu-data-container');
        container.innerHTML = '';

        const titleMap = {
            notifications: '알림',
            userPosts: '작성글',
            announcements: '공지'
        };

        const title = titleMap[menuType] || '정보';
        let html = `<div class="menu-data"><h3>${title}</h3>`;

        if (data.length === 0) {
            html += '<p>(내용이 없습니다)</p>';
        } else {
            data.forEach(item => {
                html += `<p>${item}</p>`;
            });
        }

        html += '</div>';
        container.innerHTML = html;
    }
</script>

</body>
</html>
