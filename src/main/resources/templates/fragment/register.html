<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
    <link href="/static/css/reset.css" rel="stylesheet">
    <link href="/static/css/base.css" rel="stylesheet">
</head>
<body>
<article id="register">
    <h2>내 정보</h2>
    <div class="profile-content">
        <div class="profile-image">
            <div class="image-circle" id="imagePreview"></div>
            <input id="imageInput" onchange="previewImage(event)" style="display: none;" type="file">
            <button class="image-btn" onclick="document.getElementById('imageInput').click()">이미지 변경</button>
        </div>
        <div class="profile-form">
            <label>
                <span>닉네임</span>
                <input id="nickname" name="nickname" th:placeholder="${user.nickname}" th:value="${user.nickname}"
                       type="text">
                <button class="check-btn" onclick="checkNickname()">중복 확인</button>
            </label>
            <label>
                <span>이메일</span>
                <input id="email" readonly th:placeholder="'oremi6@kakao.com'" th:value="${user.email}"
                       type="email">
            </label>
            <label>
                <span>한줄 소개</span>
                <textarea id="selfIntro" th:placeholder="'안녕하세요 오르미 6기입니다'"
                          th:text="${user.selfIntro}"></textarea>
            </label>
            <label>
                <span>링크</span>
                <input id="snsLink" th:placeholder="${user.snsLink}" th:value="${user.snsLink}" type="text">
            </label>
        </div>
        <div class="btn-group">
            <button class="save-btn" onclick="submitForm()" type="button">가입 완료</button>
            <button class="cancel-btn" onclick="cancelEdit()">취소</button>
        </div>
    </div>
</article>

<script>
    // 프로필 이미지 미리보기
    document.getElementById("profileImageInput").addEventListener("change", function (event) {
        const reader = new FileReader();
        reader.onload = function () {
            document.getElementById("profileImage").src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    });

    // 폼 제출 함수
    function submitForm() {
        $.ajax({
            type: 'POST',
            url: '/member/register',
            contentType: 'application/json',
            data: JSON.stringify({
                email: $("#email").val(),
                nickname: $("#nickname").val(),
                profileImageUrl: $("#profileImage").attr("src"),
                selfIntro: $("#selfIntro").val(),
                snsLink: $("#snsLink").val()
            }),
            success: function () {
                alert('회원가입이 완료되었습니다!');
                window.location.href = '/oauth2/authorization/kakao'; // 필요한 URL로 리다이렉트
            },
            error: function (error) {
                console.error('Error:', error);
                alert('회원가입 중 오류가 발생했습니다.');
            }
        });
    }
</script>
</body>
</html>
